<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,300;0,400;0,500;0,700;0,800;1,300;1,400;1,500;1,700;1,800&display=swap" rel="stylesheet">
    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='index.css') }}" />
  </head>
  <body>
    <div id="title">
      <h1>Facilitator View</h1>
    </div>
    <div id="contents">
      <div id="moodChecker">
        <h2 class="subtitle">Mood Checker</h2>
        <canvas id="barChart"></canvas>
      </div>
      <div id="highFive">
        <h2 class="subtitle">Remote High Five</h2>
        <canvas id="handPositions" width="400" height="300"></canvas>
      </div>
    </div>
    <div id="bottomMargin"></div>
  </body>
  <!-- Load the handtrackjs model. -->
  <script src="https://cdn.jsdelivr.net/npm/handtrackjs/dist/handtrack.min.js"> </script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
  <!--Socket IO.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
  <script>
    /**************
    Receive Socket IO
    **************/

    var socket = io()
    var ctx = document.getElementById('barChart').getContext('2d')

    var handCanvas = document.getElementById('handPositions')
    var handCtx = handCanvas.getContext("2d")
    var handPos = [
      [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0],
      [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]
    ];
    var color = ['red', 'blue', 'green', 'yellow', 'orange', 'pink', 'purple', 'grey', 'black', 'brown', 'cyan', 'Lavender']

    var chart = new Chart(ctx, {
        // The type of chart we want to create
        type: 'bar',

        // The data for our dataset
        data: {
            labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'],
            datasets: [{
                label: 'Mood Checker',
                backgroundColor: 'rgb(255, 142, 0)',
                borderColor: 'rgb(255, 142, 0)',
                data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
            }]
        },

        // Configuration options go here
        options: {
          scales: {
              yAxes: [{
                  ticks: {
                      max: 100,
                      min: 0,
                      stepSize: 10
                  }
              }]
          }
        }
    });

    socket.on("new_mood", (data) => {
      var obj = JSON.parse(data)
      var index = obj.clients.indexOf(obj.from)
      chart.data.datasets[0].data[index] = obj.content
      chart.update()
      console.log(obj)
    })

    socket.on("new_handPosition", (data) => {
      //reset canvas
      handCtx.fillStyle = "white";
      handCtx.fillRect(0, 0, handCanvas.width, handCanvas.height);

      var obj = JSON.parse(data)
      var index = obj.clients.indexOf(obj.from)
      handPos[index][0] = obj.content.x + (obj.content.width / 2)
      handPos[index][1] = obj.content.y + (obj.content.height / 2)

      for(var i=0; i<handPos.length; i++){
        handCtx.beginPath();
        // handCtx.arc(handPos[i][0], handPos[i][1], 10, 0, 2 * Math.PI);
        // handCtx.fillStyle = color[i];
        // handCtx.fill();
        // context.arc(handPos[index][0], handPos[index][1], 30, 0, 2 * Math.PI);
        // context.fillStyle = color[index];
        // context.fill();
        var path = new Path2D('m8.56 24.011c-.276 0-.5-.224-.5-.5v-.87c0-.309-.094-.606-.271-.86l-1.007-1.437c-.587-.84-1.084-1.723-1.477-2.623-.495-1.133-1.563-3.273-3.167-4.878-.055-.055-.096-.122-.121-.195-.022-.065-.201-.654.214-1.23.444-.615 1.373-.928 2.76-.928 1.296 0 2.32.836 3 1.629v-9.13c0-1.103.897-2 2-2 .412 0 .794.125 1.112.339.274-.779 1.017-1.339 1.888-1.339s1.614.56 1.888 1.339c.318-.214.701-.339 1.112-.339 1.103 0 2 .897 2 2v2.269c.294-.171.636-.269 1-.269 1.152 0 2.049.897 2.049 2v7l-.091 1.942c-.101 2.136-.916 4.21-2.296 5.841-.22.26-.342.592-.342.933v.805c0 .276-.224.5-.5.5s-.5-.224-.5-.5v-.805c0-.577.206-1.138.578-1.579 1.239-1.463 1.971-3.324 2.061-5.241l.09-1.919v-6.977c0-.552-.449-1-1-1-.6 0-1.049.448-1.049 1v6c0 .276-.224.5-.5.5s-.5-.224-.5-.5v-10c0-.552-.449-1-1-1s-1 .448-1 1v10c0 .276-.224.5-.5.5s-.5-.224-.5-.5v-11c0-.552-.449-1-1-1s-1 .448-1 1v11c0 .276-.224.5-.5.5s-.5-.224-.5-.5v-10c0-.552-.449-1-1-1s-1 .448-1 1v10.75c0 .231-.16.433-.385.486s-.458-.056-.562-.264c-.013-.024-1.258-2.473-3.053-2.473-1.404 0-1.825.351-1.94.501-.074.096-.091.193-.092.262 1.572 1.616 2.639 3.64 3.262 5.068.367.841.831 1.665 1.38 2.45l1.007 1.437c.295.423.452.919.452 1.434v.87c0 .277-.224.501-.5.501z');
        handCtx.strokeStyle = color[i];
        handCtx.translate(handPos[i][0], handPos[i][1]);
        handCtx.scale(3, 3);
        handCtx.lineWidth = 0.8;
        handCtx.stroke(path);
      }
    })

  </script>
</html>
